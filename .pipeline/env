#!/bin/bash

# TEMPORARY REMOVE SOON!!!
export CI_PROJECT_VISIBILITY="notpublic"

# Variables accessible in staging start with ENV_STAGING_
# ENV_STAGING_=""
# Variables accessible in qa start with ENV_QA_
# ENV_QA_=""
# Variables accessible in qa start with ENV_PROD_
# ENV_PROD_=""

# Variables accessible in nut start with ENV_NUT_
# ENV_NUT_=""
# Variables accessible in thoth start with ENV_THOTH_
# ENV_THOTH_=""


# NOTE:
# NUT and THOTH variables overwrite STAGING QA and PROD variables

function prefixed_variables {
	env | grep "^$1" | sed -e "s/^$1//"
}

# all variables
source <(prefixed_variables ENV_ALL_ | sed -e "s/^/export K8S_SECRET_/")

# variables related to stages
case $CI_JOB_STAGE in 
	staging)
		source <(prefixed_variables ENV_STAGING_ | sed -e "s/^/export K8S_SECRET_/")
		;;

	qa)
		source <(prefixed_variables ENV_QA_ | sed -e "s/^/export K8S_SECRET_/")

		export KUBE_NAMESPACE="mpdl-bloxberg-qa"
		;;

	production)
		source <(prefixed_variables ENV_PROD_ | sed -e "s/^/export K8S_SECRET_/")
		;;
esac

# variables related to server
case $(hostname) in 
	thoth)
		source <(prefixed_variables ENV_THOTH_ | sed -e "s/^/export K8S_SECRET_/")

		# hardcoded for the moment
		export ip="10.254.1.15"
		;;

	nut)
		source <(prefixed_variables ENV_NUT_ | sed -e "s/^/export K8S_SECRET_/")

		# hardcoded for the moment
		export ip="10.254.1.14"
		;;
esac
